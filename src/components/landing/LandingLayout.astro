---
import Navbar from "./Navbar.astro";
import Hero from "./Hero.astro";
import Features from "./Features.astro";
import Privacy from "./Privacy.astro";
import Apps from "./Apps.astro";
import Models from "./Models.astro";
import Footer from "./Footer.astro";
import { getLanguageFromURL } from "@/lib/i18n";

const urlLang = getLanguageFromURL(Astro.url);
const { lang = urlLang } = Astro.props;

const translations = {
  en: {
    nav: {
      chatbot: "Create your own chatbot",
      models: "Discover models",
      contact: "Contact us",
      cta: "Open App",
    },
    hero: {
      badge: "100% Local AI",
      title: "Your AI,",
      title2: "Your Data.",
      subtitle:
        "Chat with your documents, search the web, and use powerful AI tools. Everything stays on your device. Nothing is sent to the cloud.",
      cta: "Start Now",
      chatbotCta: "Create your own chatbot",
      feature1: "No data leaves your device",
      feature2: "Works offline",
      card1Title: "Your Documents",
      card1Desc: "Chat with PDFs, texts & more",
      card2Title: "Web Search",
      card2Desc: "Research without tracking",
      card3Title: "Memory",
      card3Desc: "AI remembers what you want",
      card4Title: "Apps",
      card4Desc: "Connect your tools via MCP",
    },
    features: {
      label: "Features",
      title: "Everything you need,",
      title2: "nothing you don't.",
      subtitle:
        "Powerful AI capabilities that respect your privacy and give you full control.",
      documentsTitle: "Chat with Documents",
      documentsDesc:
        "Upload PDFs, text files, or Markdown. Ask questions and get instant answers from your own files.",
      webTitle: "Web Search",
      webDesc:
        "Search the internet for information. The AI analyzes sources and brings you relevant results without tracking.",
      memoryTitle: "Persistent Memory",
      memoryDesc:
        "Tell the AI what to remember. It stores your preferences and context across conversations.",
      mcpTitle: "MCP Integrations",
      mcpDesc:
        "Connect to external tools and services via the Model Context Protocol. Extend AI capabilities.",
      privacyTitle: "100% Private",
      privacyDesc:
        "Everything runs in your browser. Your data never leaves your device. No servers, no tracking.",
      offlineTitle: "Works Offline",
      offlineDesc:
        "Once models are loaded, use the AI without internet. Perfect for travel or weak connections.",
    },
    privacySection: {
      label: "Privacy First",
      title: "Your data stays",
      title2: "with you.",
      description:
        "Traditional AI services upload your data to their servers. Edge.AI is different. Everything runs 100% locally in your browser. Your documents, chats, and searches never leave your device.",
      point1: "No data sent to external servers",
      point2: "All processing happens locally",
      point3: "Your documents stay on your device",
      point4: "No tracking or analytics",
    },
    apps: {
      label: "Integrations",
      title: "Connect your",
      title2: "favorite tools.",
      subtitle:
        "Edge.AI integrates with external apps and services. Extend AI capabilities with MCP and custom apps.",
      app1Name: "InLinked",
      app1Desc: "Format and optimize your LinkedIn posts",
      app2Name: "InQR",
      app2Desc: "Generate QR codes and barcodes instantly",
      app3Name: "Custom MCP",
      app3Desc: "Connect to any service via MCP protocol",
      ctaText: "And many more integrations coming soon...",
    },
    models: {
      label: "AI Models",
      title: "Try the best models,",
      title2: "locally.",
      subtitle:
        "Choose from a variety of models optimized for different needs.",
      viewAll: "View all models",
    },
    enterprise: {
      enterpriseLabel: "Enterprise",
      enterpriseTitle: "Need a custom solution?",
      enterpriseDesc:
        "Contact Inled for custom deployments, integrations, or enterprise solutions.",
      enterpriseCta: "Contact Inled",
    },
    footer: {
      tagline: "AI that respects your privacy.",
      link1: "Features",
      link2: "Privacy",
      link3: "Integrations",
      license: "Open Source",
      made: "Made with",
      made2: "for privacy",
    },
  },
  es: {
    nav: {
      chatbot: "Crea tu propio chatbot",
      models: "Descubre modelos",
      contact: "Contacta con nosotros",
      cta: "Abrir App",
    },
    hero: {
      badge: "IA 100% Local",
      title: "Tu IA,",
      title2: "Tus datos.",
      subtitle:
        "Chatea con tus documentos, busca en la web y usa herramientas de IA potentes. Todo se queda en tu dispositivo. Nada se envía a la nube.",
      cta: "Comenzar",
      chatbotCta: "Crea tu propio chatbot",
      feature1: "Ningún dato sale de tu dispositivo",
      feature2: "Funciona sin internet",
      card1Title: "Tus Documentos",
      card1Desc: "Chatea con PDFs, textos y más",
      card2Title: "Búsqueda Web",
      card2Desc: "Investiga sin ser rastreado",
      card3Title: "Memoria",
      card3Desc: "La IA recuerda lo que quieres",
      card4Title: "Apps",
      card4Desc: "Conecta tus herramientas vía MCP",
    },
    features: {
      label: "Características",
      title: "Todo lo que necesitas,",
      title2: "nada que no quieras.",
      subtitle:
        "Capacidades de IA potentes que respetan tu privacidad y te dan control total.",
      documentsTitle: "Chatea con Documentos",
      documentsDesc:
        "Sube PDFs, archivos de texto o Markdown. Haz preguntas y obtén respuestas instantáneas de tus propios archivos.",
      webTitle: "Búsqueda Web",
      webDesc:
        "Busca información en internet. La IA analiza fuentes y te trae resultados relevantes sin rastrear.",
      memoryTitle: "Memoria Persistente",
      memoryDesc:
        "Dile a la IA qué recordar. Guarda tus preferencias y contexto entre conversaciones.",
      mcpTitle: "Integraciones MCP",
      mcpDesc:
        "Conecta con herramientas y servicios externos a través del Model Context Protocol.",
      privacyTitle: "100% Privado",
      privacyDesc:
        "Todo funciona en tu navegador. Tus datos nunca salen de tu dispositivo. Sin servidores, sin seguimiento.",
      offlineTitle: "Funciona Sin Internet",
      offlineDesc:
        "Una vez cargados los modelos, usa la IA sin conexión. Perfecto para viajes o conexiones lentas.",
    },
    privacySection: {
      label: "Privacidad Primero",
      title: "Tus datos se quedan",
      title2: "contigo.",
      description:
        "Los servicios de IA tradicionales suben tus datos a sus servidores. Edge.AI es diferente. Todo funciona 100% local en tu navegador. Tus documentos, chats y búsquedas nunca salen de tu dispositivo.",
      point1: "No se envía datos a servidores externos",
      point2: "Todo el procesamiento es local",
      point3: "Tus documentos se quedan en tu dispositivo",
      point4: "Sin seguimiento ni analíticas",
    },
    apps: {
      label: "Integraciones",
      title: "Conecta tus",
      title2: "herramientas favoritas.",
      subtitle:
        "Edge.AI se integra con aplicaciones y servicios externos. Extiende las capacidades de IA con MCP y apps personalizadas.",
      app1Name: "InLinked",
      app1Desc: "Formatea y optimiza tus posts de LinkedIn",
      app2Name: "InQR",
      app2Desc: "Genera códigos QR y de barras al instante",
      app3Name: "MCP Personalizado",
      app3Desc: "Conecta a cualquier servicio vía protocolo MCP",
      ctaText: "Y muchas más integraciones en camino...",
    },
    models: {
      label: "Modelos de IA",
      title: "Prueba los mejores modelos,",
      title2: "localmente.",
      subtitle:
        "Elige entre una variedad de modelos optimizados para diferentes necesidades.",
      viewAll: "Ver todos los modelos",
    },
    enterprise: {
      enterpriseLabel: "Empresas",
      enterpriseTitle: "¿Necesitas una solución personalizada?",
      enterpriseDesc:
        "Contacta con Inled para despliegues personalizados, integraciones o soluciones empresariales.",
      enterpriseCta: "Contactar con Inled",
    },
    footer: {
      tagline: "IA que respeta tu privacidad.",
      link1: "Características",
      link2: "Privacidad",
      link3: "Integraciones",
      license: "Código Abierto",
      made: "Hecho con",
      made2: "para la privacidad",
    },
  },
};

const t = translations[lang as keyof typeof translations] || translations.en;
console.log(
  "Rendering LandingLayout with lang:",
  lang,
  "t.nav.chatbot:",
  t.nav.chatbot,
);
---

<!doctype html>
<html lang={lang} data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Edge.AI - 100% Local AI. Chat with your documents, search the web, and use powerful AI tools. Everything stays on your device."
    />
    <title>Edge.AI | Private & Local AI Assistant</title>
    <link rel="icon" type="image/png" href="/inledai.png" />
    <style is:global>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap");
    </style>
    <script is:inline>
      // Redirect if localStorage language is different from URL and no lang param is present
      (function () {
        const urlParams = new URLSearchParams(window.location.search);
        const storedLang = localStorage.getItem("edgeai-lang");
        const currentURL = new URL(window.location.href);

        if (
          !urlParams.has("lang") &&
          storedLang &&
          ["en", "es"].includes(storedLang)
        ) {
          const currentHtmlLang = document.documentElement.lang;
          if (storedLang !== currentHtmlLang) {
            // If we are on a model page, we might also need to swap the path
            let newPath = currentURL.pathname;
            if (storedLang === "es") {
              newPath = newPath
                .replace("/model/", "/modelo/")
                .replace("/models", "/modelos");
            } else {
              newPath = newPath
                .replace("/modelo/", "/model/")
                .replace("/modelos", "/models");
            }
            currentURL.pathname = newPath;
            currentURL.searchParams.set("lang", storedLang);
            window.location.replace(currentURL.toString());
          }
        }
      })();
    </script>
  </head>
  <body>
    <Navbar currentLang={lang} translations={t.nav} />
    <main>
      <Hero translations={t.hero} />
      <Features translations={t.features} />
      <Privacy translations={t.privacySection} />
      <Apps translations={t.apps} />
      <Models translations={t.models} lang={lang} />
    </main>
    <Footer translations={t.footer} currentLang={lang} />

    <script is:inline define:vars={{ translations }}>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const urlLang =
          urlParams.get("lang") || localStorage.getItem("edgeai-lang") || "es";
        const currentHtmlLang = document.documentElement.lang;

        console.log(
          "Hydration - Rendering:",
          currentHtmlLang,
          "Target:",
          urlLang,
        );

        if (urlLang !== currentHtmlLang) {
          const t = translations[urlLang] || translations.en;

          const updateText = (selector, text) => {
            const el = document.querySelector(selector);
            if (el) el.textContent = text;
          };

          const updateTitle = (selector, text1, text2) => {
            const el = document.querySelector(selector);
            if (el) {
              // Update first text node if it exists
              if (el.childNodes.length > 0 && el.childNodes[0].nodeType === 3) {
                el.childNodes[0].textContent = text1 + " ";
              }
              const gradient = el.querySelector(".gradient-text");
              if (gradient) gradient.textContent = text2;
            }
          };

          // Navbar
          const navLinks = document.querySelectorAll(".nav-link");
          if (navLinks.length >= 3) {
            navLinks[0].textContent = t.nav.chatbot;
            navLinks[1].textContent = t.nav.models;
            navLinks[2].textContent = t.nav.contact;
          }
          document
            .querySelectorAll(".cta-btn")
            .forEach((btn) => (btn.textContent = t.nav.cta));

          // Hero
          updateText(".hero-badge span", t.hero.badge);
          updateTitle(".hero-title", t.hero.title, t.hero.title2);
          updateText(".hero-subtitle", t.hero.subtitle);
          updateText(".hero-cta span", t.hero.cta);
          updateText(".hero-cta-secondary span", t.hero.chatbotCta);

          const heroFeatures = document.querySelectorAll(
            ".hero-feature span:last-child",
          );
          if (heroFeatures.length >= 2) {
            heroFeatures[0].textContent = t.hero.feature1;
            heroFeatures[1].textContent = t.hero.feature2;
          }

          const heroCards = document.querySelectorAll(".hero-card");
          if (heroCards.length >= 4) {
            heroCards[0].querySelector(".card-title").textContent =
              t.hero.card1Title;
            heroCards[0].querySelector(".card-desc").textContent =
              t.hero.card1Desc;
            heroCards[1].querySelector(".card-title").textContent =
              t.hero.card2Title;
            heroCards[1].querySelector(".card-desc").textContent =
              t.hero.card2Desc;
            heroCards[2].querySelector(".card-title").textContent =
              t.hero.card3Title;
            heroCards[2].querySelector(".card-desc").textContent =
              t.hero.card3Desc;
            heroCards[3].querySelector(".card-title").textContent =
              t.hero.card4Title;
            heroCards[3].querySelector(".card-desc").textContent =
              t.hero.card4Desc;
          }

          // Features
          updateText(".features-label", t.features.label);
          updateTitle(".features-title", t.features.title, t.features.title2);
          updateText(".features-subtitle", t.features.subtitle);

          const featureCards = document.querySelectorAll(".feature-card");
          const fKeys = [
            "documents",
            "web",
            "memory",
            "mcp",
            "privacy",
            "offline",
          ];
          featureCards.forEach((card, i) => {
            const key = fKeys[i];
            if (!key) return;
            const titleEl = card.querySelector(".feature-title");
            const descEl = card.querySelector(".feature-description");
            if (titleEl) titleEl.textContent = t.features[key + "Title"];
            if (descEl) descEl.textContent = t.features[key + "Desc"];
          });

          // Privacy
          updateText(".privacy-label", t.privacySection.label);
          updateTitle(
            ".privacy-title",
            t.privacySection.title,
            t.privacySection.title2,
          );
          updateText(".privacy-description", t.privacySection.description);

          const privacyPoints = document.querySelectorAll(
            ".privacy-point span:last-child",
          );
          if (privacyPoints.length >= 4) {
            privacyPoints[0].textContent = t.privacySection.point1;
            privacyPoints[1].textContent = t.privacySection.point2;
            privacyPoints[2].textContent = t.privacySection.point3;
            privacyPoints[3].textContent = t.privacySection.point4;
          }

          // Apps
          updateText(".apps-label", t.apps.label);
          updateTitle(".apps-title", t.apps.title, t.apps.title2);
          updateText(".apps-subtitle", t.apps.subtitle);

          const appCards = document.querySelectorAll(".app-card");
          if (appCards.length >= 3) {
            appCards[0].querySelector(".app-name").textContent =
              t.apps.app1Name;
            appCards[0].querySelector(".app-description").textContent =
              t.apps.app1Desc;
            appCards[1].querySelector(".app-name").textContent =
              t.apps.app2Name;
            appCards[1].querySelector(".app-description").textContent =
              t.apps.app2Desc;
            appCards[2].querySelector(".app-name").textContent =
              t.apps.app3Name;
            appCards[2].querySelector(".app-description").textContent =
              t.apps.app3Desc;
          }
          updateText(".apps-cta-text", t.apps.ctaText);

          // Models
          updateText(".models-label", t.models.label);
          updateTitle(".models-title", t.models.title, t.models.title2);
          updateText(".models-subtitle", t.models.subtitle);
          updateText(".view-all-btn", t.models.viewAll);

          // Footer
          updateText(".footer-tagline", t.footer.tagline);
          const footerLinks = document.querySelectorAll(".footer-link");
          if (footerLinks.length >= 3) {
            footerLinks[0].textContent = t.footer.link1;
            footerLinks[1].textContent = t.footer.link2;
            footerLinks[2].textContent = t.footer.link3;
          }
          updateText(".footer-license", t.footer.license);
          const footerMade = document.querySelector(".footer-made");
          if (footerMade) {
            footerMade.childNodes[0].textContent = t.footer.made + " ";
            const privacySpan = footerMade.querySelector("span");
            if (privacySpan) privacySpan.textContent = t.footer.made2;
          }

          // HTML Lang & Switcher
          document.documentElement.lang = urlLang;
          const langBtn = document.getElementById("langSwitcherLink");
          if (langBtn) {
            langBtn.setAttribute("data-current-lang", urlLang);
            const langSpan = langBtn.querySelector("span");
            if (langSpan) langSpan.textContent = urlLang === "en" ? "ES" : "EN";

            // Update URL to opposite for next click
            const nextLang = urlLang === "en" ? "es" : "en";
            const currentURL = new URL(window.location.href);
            currentURL.searchParams.set("lang", nextLang);
            langBtn.href = currentURL.toString();
          }
        }
      });
    </script>
  </body>
</html>

<style is:global>
  :root {
    --color-primary: #28e518;
    --color-primary-hover: #20b813;
    --color-bg: #212121;
    --color-bg-secondary: #2f2f2f;
    --color-bg-tertiary: #3f3f3f;
    --color-bg-hover: #4a4a4a;
    --color-text: #ececec;
    --color-text-secondary: #b4b4b4;
    --color-text-tertiary: #8e8e8e;
    --color-border: #3f3f3f;
    --font-sans: "Inter", system-ui, -apple-system, sans-serif;
  }

  @media (prefers-color-scheme: light) {
    :root {
      --color-primary: #20b813;
      --color-bg: #ffffff;
      --color-bg-secondary: #f8f9fa;
      --color-bg-tertiary: #f1f3f5;
      --color-bg-hover: #e9ecef;
      --color-text: #0a0a0a;
      --color-text-secondary: #525252;
      --color-text-tertiary: #a3a3a3;
      --color-border: #e5e7eb;
    }
  }

  *,
  *::before,
  *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html {
    font-family: var(--font-sans);
    font-size: 16px;
    line-height: 1.6;
    scroll-behavior: smooth;
  }

  body {
    background-color: var(--color-bg);
    color: var(--color-text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  a {
    text-decoration: none;
    color: inherit;
  }

  ::selection {
    background-color: var(--color-primary);
    color: #000;
  }
</style>
