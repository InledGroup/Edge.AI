---
import { Menu, X, Globe } from "lucide-preact";

const { currentLang = "en", translations = {} } = Astro.props;

const navLinks = [
  { href: "/aicloud", label: translations.chatbot || "Crea tu propio chatbot" },
  { href: currentLang === "es" ? "/modelos" : "/models", label: translations.models || "Descubre modelos" },
  { href: "https://inled.es/contacto", label: translations.contact || "Contacta con nosotros" },
];
---

<nav class="fixed top-0 left-0 right-0 z-50 glass-nav">
  <div
    class="container mx-auto px-4 md:px-6 h-16 md:h-20 flex items-center justify-between"
  >
    <!-- Logo -->
    <div class="flex items-center gap-3">
      <img
        src="/inledai.png"
        class="w-8 h-8 md:w-10 md:h-10 rounded-lg md:rounded-xl"
        alt="Edge.AI"
      />
      <a class="text-lg md:text-xl font-bold tracking-tight" href="/landing">
        Edge<span class="text-primary">.AI</span>
      </a>
    </div>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-8">
      {
        navLinks.map((link) => (
          <a href={link.href} class="nav-link text-sm font-medium">
            {link.label}
          </a>
        ))
      }
    </div>

    <!-- Right Section -->
    <div class="flex items-center gap-3">
      <!-- Language Switcher -->
      <a
        href="#"
        class="lang-btn"
        id="langSwitcherLink"
        data-current-lang={currentLang}
      >
        <Globe size={18} />
        <span class="hidden sm:inline"
          >{currentLang === "en" ? "ES" : "EN"}</span
        >
      </a>

      <!-- CTA Button -->
      <a href="/" class="cta-btn">
        {translations.cta || "Open App"}
      </a>

      <!-- Mobile Menu Button -->
      <button
        id="mobileMenuBtn"
        class="md:hidden p-2 text-text-secondary hover:text-text transition-colors"
      >
        <Menu size={24} />
      </button>
    </div>
  </div>
</nav>

<!-- Mobile Menu Overlay -->
<div id="mobileNav" class="mobile-nav hidden">
  <div class="mobile-nav-content">
    <button
      id="closeMobileNav"
      class="absolute top-4 right-4 p-2 text-text-secondary hover:text-text"
    >
      <X size={28} />
    </button>
    <div class="flex flex-col items-center gap-8">
      {
        navLinks.map((link) => (
          <a href={link.href} class="mobile-nav-link text-2xl font-bold">
            {link.label}
          </a>
        ))
      }
      <a
        href="/"
        class="mt-4 px-8 py-4 bg-primary text-black font-bold rounded-xl"
      >
        {translations.cta || "Open App"}
      </a>
    </div>
  </div>
</div>

<style>
  .glass-nav {
    background: rgba(33, 33, 33, 0.85);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--color-border);
  }

  .text-primary {
    color: var(--color-primary);
  }

  .nav-link {
    color: var(--color-text-secondary);
    transition: color 0.2s ease;
    position: relative;
  }

  .nav-link:hover {
    color: var(--color-text);
  }

  .nav-link::after {
    content: "";
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--color-primary);
    transition: width 0.3s ease;
  }

  .nav-link:hover::after {
    width: 100%;
  }

  .lang-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.75rem;
    background: var(--color-bg-tertiary);
    border: 1px solid var(--color-border);
    border-radius: 0.5rem;
    color: var(--color-text-secondary);
    font-size: 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .lang-btn:hover {
    background: var(--color-bg-hover);
    color: var(--color-text);
  }

  .cta-btn {
    display: none;
    padding: 0.625rem 1.25rem;
    background: var(--color-primary);
    color: black;
    font-weight: 700;
    border-radius: 0.75rem;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  @media (min-width: 768px) {
    .cta-btn {
      display: inline-block;
    }
  }

  .cta-btn:hover {
    background: var(--color-primary-hover);
    transform: translateY(-1px);
  }

  .mobile-nav {
    position: fixed;
    inset: 0;
    z-index: 100;
    background: var(--color-bg);
    animation: slideIn 0.3s ease;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .mobile-nav-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    gap: 2rem;
  }

  .mobile-nav-link {
    color: var(--color-text);
    transition: color 0.2s ease;
    text-decoration: none;
  }

  .mobile-nav-link:hover {
    color: var(--color-primary);
  }

  @media (prefers-color-scheme: light) {
    .glass-nav {
      background: rgba(255, 255, 255, 0.85);
    }
    .cta-btn {
      color: white;
    }
  }
</style>

<script>
  const mobileMenuBtn = document.getElementById("mobileMenuBtn");
  const mobileNav = document.getElementById("mobileNav");
  const closeMobileNav = document.getElementById("closeMobileNav");

  mobileMenuBtn?.addEventListener("click", () => {
    mobileNav?.classList.remove("hidden");
    document.body.style.overflow = "hidden";
  });

  closeMobileNav?.addEventListener("click", () => {
    mobileNav?.classList.add("hidden");
    document.body.style.overflow = "";
  });

  // Robust Language Switcher
  const langSwitcher = document.getElementById("langSwitcherLink");
  if (langSwitcher) {
    const updateSwitcherHref = () => {
      const currentLang =
        langSwitcher.getAttribute("data-current-lang") || "en";
      const newLang = currentLang === "en" ? "es" : "en";
      const url = new URL(window.location.href);

      // Update the path if necessary (e.g., /model/ -> /modelo/)
      let newPath = url.pathname;
      if (newLang === "es") {
        newPath = newPath
          .replace("/model/", "/modelo/")
          .replace("/models", "/modelos");
      } else {
        newPath = newPath
          .replace("/modelo/", "/model/")
          .replace("/modelos", "/models");
      }

      url.pathname = newPath;
      url.searchParams.set("lang", newLang);
      (langSwitcher as HTMLAnchorElement).href = url.toString();
    };

    // Initial update
    updateSwitcherHref();

    langSwitcher.addEventListener("click", (e) => {
      // Allow the actual href navigation, but sync localStorage first
      const currentLang =
        langSwitcher.getAttribute("data-current-lang") || "en";
      const newLang = currentLang === "en" ? "es" : "en";
      localStorage.setItem("edgeai-lang", newLang);

      // We don't necessarily need e.preventDefault() if the href is already correct
      // But let's be safe and handle it explicitly to ensure URL is always fresh
      e.preventDefault();
      window.location.href = (langSwitcher as HTMLAnchorElement).href;
    });
  }

  document.querySelectorAll(".mobile-nav-link").forEach((link) => {
    link.addEventListener("click", () => {
      mobileNav?.classList.add("hidden");
      document.body.style.overflow = "";
    });
  });
</script>
